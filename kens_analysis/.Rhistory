setwd(wd)
setwd("..")
data_directory = '../data/'
library(ggplot2)
setwd("~/Documents/smt-data-challenge/kens_analysis")
library(dplyr)
library(patchwork)
game_info <- arrow::open_csv_dataset(paste0(data_directory, "game_info"),
partitioning = c("Season", "HomeTeam", "AwayTeam", "Day"),
hive_style = F,
unify_schemas = T,
na = c("", "NA", "NULL", NA, "\\N"))
game_events <- arrow::open_csv_dataset(paste0(data_directory,"game_events"),
partitioning = c("Season", "HomeTeam", "AwayTeam", "Day"),
hive_style = F,
unify_schemas = T,
na = c("", "NA", "NULL", NA, "\\N"))
ball_pos <- arrow::open_csv_dataset(paste0(data_directory,"ball_pos"),
partitioning = c("Season", "HomeTeam", "AwayTeam", "Day"),
hive_style = F,
unify_schemas = T,
na = c("", "NA", "NULL", NA, "\\N"))
game_info_ball <- game_info |>
filter(inning > 0, top_bottom == "bottom", !is.na(batter)) |>
collect() |>
select(game_str, play_per_game, top_bottom, batter)
View(game_info_ball)
game_events_ball <- game_events|>
filter() |>
collect() |>
select(game_str, play_id, play_per_game, event_code, timestamp)
source("~/Documents/smt-data-challenge/kens_analysis/Ball Release.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/Batter Hand.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/Ball Release.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/batter_hand.R", echo=TRUE)
rm(list=ls())
source("~/Documents/smt-data-challenge/kens_analysis/batter_hand.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/ball_release.R", echo=TRUE)
for(i in 1:nrow(fair_hits)) {
cur_row <- fair_hits[i,]
cur_row$ball_dist <- sqrt((curRow$ball_position_x^2) + (curRow$ball_position_y^2))
fair_hits[i,] <- cur_row
}
source("~/Documents/smt-data-challenge/kens_analysis/ball_release.R", echo=TRUE)
write.csv(batter_hits, "Combined_Batter_Hits.csv")
write.csv(grouped_hits, "hit_outcomes.csv")
grouped_hits <- batter_hits |>
group_by(batter,hand) |>
summarize(
pull <- sum(push_pull == "pull"),
push <- sum(push_pull == "push")
) |>
filter(batter < 1000)
names(grouped_hits) <- c("battter", "hand", "pull", "push")
write.csv(grouped_hits, "hit_outcomes.csv")
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
View(pitcher_pitch_info)
write.csv(batter_hits, "combined_batter_hits.csv")
write.csv(batter_hits, "combined_batter_hits.csv")
batter_pitch_info <- read.csv("combined_batter_hits.csv")
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
source("~/Documents/smt-data-challenge/kens_analysis/batter_hand.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/ball_release.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/batter_pitcher_hits.R", echo=TRUE)
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$y_ball_pos > 0) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
View(pitcher_pitch_info)
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$x_ball_pos > 0) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv") |>
filter(is.na(pitcher_player_id))
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$x_ball_pos > 0 || is.na(cur_row$x_ball_pos)) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$x_ball_pos > 0 | is.na(cur_row$x_ball_pos)) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
View(pitcher_pitch_info)
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$x_ball_pos > 0 | is.na(cur_row$x_ball_pos)) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$x_ball_pos > 0) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(cur_row$x_ball_pos > 0) {
cur_row$hand = 'L'
}
if(is.na(cur_row$x_ball_pos)) {
cur_row$hand <- NA
}
pitcher_pitch_info[i,] <- cur_row
}
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(is.na(cur_row$x_ball_pos)) {
cur_row$hand <- NA
}
else if(cur_row$x_ball_pos > 0) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv")
pitcher_pitch_info$hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
print(i)
cur_row <- pitcher_pitch_info[i,]
if(is.na(cur_row$x_ball_pos)) {
cur_row$hand <- NA
}
else if(cur_row$x_ball_pos > 0) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
View(pitcher_pitch_info)
View(batter_pitch_info)
pitcher_vs_batter <- merge(x = batter_pitch_info, y = pitcher_pitch_info, by = c("game_str", "play_per_game"))
View(pitcher_vs_batter)
View(pitcher_pitch_info)
View(pitcher_pitch_info)
pitcher_pitch_info <- read.csv("../dougs_analysis/pitcher-location.csv") |>
select(game_str, play_per_game, x_ball_pos)
pitcher_pitch_info$pitcher_hand = 'R'
for(i in 1:nrow(pitcher_pitch_info)) {
cur_row <- pitcher_pitch_info[i,]
if(is.na(cur_row$x_ball_pos)) {
cur_row$hand <- NA
}
else if(cur_row$x_ball_pos > 0) {
cur_row$hand = 'L'
}
pitcher_pitch_info[i,] <- cur_row
}
View(pitcher_pitch_info)
pitcher_vs_batter <- merge(x = batter_pitch_info, y = pitcher_pitch_info, by = c("game_str", "play_per_game"))
View(pitcher_vs_batter)
View(batter_pitch_info)
source("~/Documents/smt-data-challenge/kens_analysis/batter_pitcher_hits.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/batter_pitcher_hits.R", echo=TRUE)
warnings()
source("~/Documents/smt-data-challenge/kens_analysis/batter_pitcher_hits.R", echo=TRUE)
View(pitcher_vs_batter)
grouped_pitcher_vs_batter <-
group_by(batter, pitcher_hand) |>
count = n()
p
grouped_pitcher_vs_batter <-
group_by(batter, pitcher_hand) |>
summarise(
count = n()
) |>
ungroup()
grouped_pitcher_vs_batter <- pitcher_vs_batter |>
group_by(batter, pitcher_hand) |>
summarise(
count = n()
) |>
ungroup()
View(grouped_pitcher_vs_batter)
grouped_pitcher_vs_batter <- pitcher_vs_batter |>
group_by(batter, pitcher_hand) |>
summarise(
count = n(),
count_right = sum(hand == "R"),
count_left = sum(hand == "L")
) |>
ungroup()
grouped_pitcher_vs_batter <- pitcher_vs_batter |>
group_by(batter, pitcher_hand, hand) |>
summarise(
count = n(),
) |>
ungroup()
batter_hits <- merge(x = fair_hits, y = batter_id, by = c("game_str", "play_id", "play_per_game")) |>
select(game_str, play_id, play_per_game, ball_position_x, ball_position_y, ball_position_z, batter.x, ball_dist, field_x, field_y, hand) |>
filter(batter < 1000)
batter_hits <- merge(x = fair_hits, y = batter_id, by = c("game_str", "play_id", "play_per_game")) |>
select(game_str, play_id, play_per_game, ball_position_x, ball_position_y, ball_position_z, batter.x, ball_dist, field_x, field_y, hand) |>
filter(batter.x < 1000)
names(batter_hits)[names(batter_hits) == 'batter.x'] <- 'batter'
plot1 <- batter_hits |>
filter(batter == 993, hand == 'R') |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 <- batter_hits |>
filter(batter == 993, hand == 'L') |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 + plot1
batter_hits$hit_side <- 'R'
batter_hits$push_pull <- 'push'
for(i in 1:nrow(batter_hits)) {
cur_row <- batter_hits[i,]
if(cur_row$ball_position_x < 0) {
cur_row$hit_side <- 'L'
}
if(cur_row$hit_side != cur_row$hand) {
cur_row$push_pull <- 'pull'
}
batter_hits[i,] <- cur_row
}
write.csv(batter_hits, "combined_batter_hits.csv")
grouped_hits <- batter_hits |>
group_by(batter,hand) |>
summarize(
pull <- sum(push_pull == "pull"),
push <- sum(push_pull == "push")
) |>
names(grouped_hits) <- c("battter", "hand", "pull", "push")
grouped_hits <- batter_hits |>
group_by(batter,hand) |>
summarize(
pull <- sum(push_pull == "pull"),
push <- sum(push_pull == "push")
)
View(grouped_hits)
names(grouped_hits) <- c("battter", "hand", "pull", "push")
write.csv(grouped_hits, "hit_outcomes.csv")
source("~/Documents/smt-data-challenge/kens_analysis/batter_pitcher_hits.R", echo=TRUE)
source("~/Documents/smt-data-challenge/kens_analysis/batter_pitcher_hits.R", echo=TRUE)
View(grouped_pitcher_vs_batter)
grouped_pitcher_vs_batter <- pitcher_vs_batter |>
group_by(batter, pitcher_hand, hand) |>
summarise(
count = n(),
push = sum(push_pull == "push"),
pull = sum(push_pull == "pull")
) |>
ungroup()
plot1 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "L", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "R", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot3 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "L", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot4 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "R", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
(plot1 + plot2) / (plot3 + plot4)
plot1 <- pitcher_vs_batter |>
filter(batter == 993, hand == "L", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "R", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot3 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "L", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot4 <- grouped_pitcher_vs_batter |>
filter(batter == 993, hand == "R", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
(plot1 + plot2) / (plot3 + plot4)
plot1 <- pitcher_vs_batter |>
filter(batter == 993, hand == "L", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 <- pitcher_vs_batter |>
filter(batter == 993, hand == "R", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot3 <- pitcher_vs_batter |>
filter(batter == 993, hand == "L", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot4 <- pitcher_vs_batter |>
filter(batter == 993, hand == "R", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
(plot1 + plot2) / (plot3 + plot4)
View(grouped_pitcher_vs_batter)
plot1 <- pitcher_vs_batter |>
filter(batter == 991, hand == "L", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 <- pitcher_vs_batter |>
filter(batter == 991, hand == "R", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot3 <- pitcher_vs_batter |>
filter(batter == 991, hand == "L", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot4 <- pitcher_vs_batter |>
filter(batter == 991, hand == "R", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
(plot1 + plot2) / (plot3 + plot4)
plot1 <- pitcher_vs_batter |>
filter(batter == 786, hand == "L", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot2 <- pitcher_vs_batter |>
filter(batter == 786, hand == "R", pitcher_hand == "R") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot3 <- pitcher_vs_batter |>
filter(batter == 786, hand == "L", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
plot4 <- pitcher_vs_batter |>
filter(batter == 786, hand == "R", pitcher_hand == "L") |>
ggplot(aes(x = ball_position_x, y = ball_position_y)) + geom_point()
(plot1 + plot2) / (plot3 + plot4)
